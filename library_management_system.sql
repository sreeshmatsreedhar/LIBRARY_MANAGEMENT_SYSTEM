-- CREATE DATABASE
CREATE DATABASE LIBRARY;
USE LIBRARY;
-- CREATE TABLE BRANCH
CREATE TABLE BRANCH(BRANCH_NO INT PRIMARY KEY,
MANAGER_ID INT,
BRANCH_ADDRESS VARCHAR(100),
CONTACT_NO INT(10)
);
-- INSERT VALUES TO BRANCH TABLE
INSERT INTO BRANCH VALUES
(1001,101,'SECOND STREET,MANJADIKUNNU ',98876543),
(1002,102,'NO21 STREET ,NORWAY',12345678),
(1003,103,'ARCADE JUNCTION ,NAW DELHI',09876543),
(1004,104,'NO20 MADRAS',0987654321),
(1005,105,'CHOTTA MUMBAI ,DARAVI',11223344);

-- CREATE TABLE EMPLOYEE
CREATE TABLE EMPLOYEE(EMP_ID INT PRIMARY KEY,
EMP_NAME VARCHAR(50),
POSITION VARCHAR(50),
SALARY DECIMAL(10,2)
);

-- INSERT VALUES TO EMPLOYEE TABLE
INSERT INTO EMPLOYEE VALUES
(101,'RAHUL DEV','LIBRARY MANAGER',52003.9),
(102,'PREETI JOSE','SENIOR LIBRARIAN',50009),
(103,'ANNA MARIYAM','LIBRARY ASSISTANT',29177),
(104,'GOPIKA SUDARSHAN','LIBRARY TECHNICIAN',22458),
(105,'FARHAAN SIDDIQ','LIBRARIAN',29345);
-- CREATE TABLE CUSTOMER
CREATE TABLE CUSTOMER (CUSTOMER_ID INT PRIMARY KEY,
CUSTOMER_NAME VARCHAR(100),
CUSTOMER_ADDRESS VARCHAR(100),
REG_DATE DATE
);
-- INSERT VALUES TO CUSTOMER TABLE
INSERT INTO CUSTOMER VALUES
(201,'KARUNAKARAN','KARUNA BHAVAN ,SECOND STREET','2021-09-11'),
(202,'LIJO JOSE','SILVER CASTLE ,WESTHILL','2021-01-08'),
(203,'MATHUKUTTY','PUTHANPURA,DOWN SREET','2023-07-09'),
(204,'DEVI K','CHALAKUDI ,THRISSUR','2001-11-27'),
(205,'GEORGE','MANNUR ,KOZHIKODE','2023-06-29');
-- CREATE TABLE ISSUESTATUS 
CREATE TABLE ISSUESTATUS(ISSUE_ID INT PRIMARY KEY,
ISSUED_CUST INT,FOREIGN KEY(ISSUED_CUST) REFERENCES CUSTOMER(CUSTOMER_ID),
ISSUED_BOOK_NAME VARCHAR(200),
ISSUED_DATE DATE,
ISBN_BOOK VARCHAR(30),FOREIGN KEY (ISBN_BOOK) REFERENCES BOOK(ISBN)
);
-- INSERT VALUES TO ISSUESTATUS TABLE
INSERT INTO ISSUESTATUS VALUES
(1,201,'THE FATE OF HOMO SAPIENS','2023-06-14','ISBN 978-93-90865-27-7'),
(2,202,'THE LEXICON FOR ETHICS,INTEGRITY&APTITUDE','2023-06-15','ISBN 340-20-21395'),
(3,203,'INDIAN ECONOMY','2019-09-12','ISBN 13-978-93-5318-636-6'),
(4,204,'INDIA S ANCIENT PAST','2022-02-18','ISBN 0-19-568785-X'),
(5,205,'A BRIEF HISTORY OF MODERN INDIA','2023-06-09','ISBN 81-7930-819-7');
-- CREATE TABLE RETURNSTATUS
CREATE TABLE RETURNSTATUS(
RETURN_ID INT PRIMARY KEY,
RETURN_CUST INT,
RETURN_BOOK_NAME VARCHAR(200),
RETURN_DATE DATE,
ISBN_BOOK2 VARCHAR(30),FOREIGN KEY(ISBN_BOOK2) REFERENCES BOOK(ISBN)
);
-- INSERT VALUES TO RETURNSTATUS TABLE
INSERT INTO RETURNSTATUS VALUES
(10,201,'THE FATE OF HOMO SAPIENS','2023-03-11','ISBN 978-93-90865-27-7'),
(11,201,'INDIA S ANCIENT PAST','2023-06-15','ISBN 0-19-568785-X'),
(12,205,'THE FATE OF HOMO SAPIENS','2022-12-01','ISBN 978-93-90865-27-7'),
(13,207,'THE LEXICON FOR ETHICS,INTEGRITY&APTITUDE','2020-06-28','ISBN 340-20-21395'),
(14,208,'INDIAN ECONOMY','2021-09-26','ISBN 13-978-93-5318-636-6');
-- CRETE TABLE BOOK
CREATE TABLE BOOK(ISBN VARCHAR(30) PRIMARY KEY,
BOOK_TITLE VARCHAR (100),
CATEGORY VARCHAR(50),
RENTAL_PRICE DECIMAL(4,2),
STATUS VARCHAR(5),
AUTHOR VARCHAR(100),
PUBLISHER VARCHAR(100)
);
-- INSERT VALUES TO BOOK TABLE
INSERT INTO BOOK VALUES
('ISBN 978-93-90865-27-7','THE FATE OF HOMO SAPIENS','NON-FICTION',30.50,'YES','H G WELLS','MATHRUBHUMI BOOKS'),
('ISBN 340-20-21395','THE LEXICON FOR ETHICS,INTEGRITY&APTITUDE','ETHICS',40,'NO','CHRONICLE EDITORIAL&NIRAJ','CHRONICLE'),
('ISBN 13-978-93-5318-636-6','INDIAN ECONOMY','ECONOMICS',50,'YES','RAMESH SIGN','McGrawHill'),
('ISBN 0-19-568785-X','INDIA S ANCIENT PAST','HISTORY',39.5,'NO','R.S.SHARMA','OXFORD UNIVERSITY PRESS'),
('ISBN 81-7930-819-7','A BRIEF HISTORY OF MODERN INDIA','HISTORY',25,'YES','RAJIV AHIR','SPECTRUM BOOKS');

-- 1.Retrieve the book title, category, and rental price of all available books.  
SELECT BOOK_TITLE,CATEGORY,RENTAL_PRICE FROM BOOK WHERE STATUS='YES';

-- 2.List the employee names and their respective salaries in descending order of salary.  
SELECT  EMP_NAME,SALARY FROM EMPLOYEE ORDER BY SALARY DESC;

-- 3.Retrieve the book titles and the corresponding customers who have issued those books.
SELECT BOOK.BOOK_TITLE,CUSTOMER.CUSTOMER_NAME FROM ISSUESTATUS JOIN BOOK ON ISSUESTATUS.ISBN_BOOK=BOOK.ISBN JOIN CUSTOMER ON ISSUESTATUS.ISSUED_CUST=CUSTOMER.CUSTOMER_ID;
 
-- 4.Display the total count of books in each category.
SELECT COUNT(*) AS TOTAL_COUNT FROM BOOK GROUP BY CATEGORY; 
-- 5.Retrieve the employee names and their positions for the employees whose salaries are above Rs.50,000. 
SELECT EMP_NAME,POSITION  FROM EMPLOYEE WHERE SALARY>50000;
-- 6.List the customer names who registered before 2022-01-01 and have not issued any books yet. 
SELECT CUSTOMER_NAME FROM CUSTOMER WHERE REG_DATE<'2022-01-01' AND CUSTOMER_ID NOT IN (SELECT ISSUED_CUST FROM ISSUESTATUS);
-- 7.Display the branch numbers and the total count of employees in each branch.
SELECT BRANCH_NO,COUNT(*) AS TOTAL_COUNT FROM EMPLOYEE JOIN BRANCH ON EMPLOYEE.EMP_ID=BRANCH.MANAGER_ID GROUP BY BRANCH_NO;
-- 8.Display the names of customers who have issued books in the month of June 2023.
SELECT CUSTOMER_NAME FROM CUSTOMER JOIN ISSUESTATUS ON CUSTOMER.CUSTOMER_ID=ISSUESTATUS.ISSUED_CUST WHERE MONTH(ISSUESTATUS.ISSUED_DATE)=6 AND YEAR(ISSUESTATUS.ISSUED_DATE) =2023;
-- 9.Retrieve book_title from book table containing history. 
SELECT BOOK_TITLE FROM BOOK WHERE CATEGORY='HISTORY';
-- 10.Retrieve the branch numbers along with the count of employees for branches having more than 5 employees. 
SELECT BRANCH_NO,COUNT(*) AS TOTAL_COUNT FROM BRANCH JOIN EMPLOYEE ON BRANCH.MANAGER_ID =EMPLOYEE.EMP_ID GROUP BY BRANCH.BRANCH_NO HAVING COUNT(*)>5;